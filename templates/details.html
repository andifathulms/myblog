{% extends 'base.html' %}

{% block extra_css %}
<style>
    /* Existing Styles */

    .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
        color: #254336;
    }

    .prose p, .prose ul, .prose ol {
        color: #6B8A7A;
    }

    .prose a {
        color: #254336;
        text-decoration: underline;
    }

    .prose a:hover {
        color: #6B8A7A;
    }

    .bg-[#FFFBF5] {
        background-color: #FFFBF5;
    }

    .text-[#254336] {
        color: #254336;
    }

    .text-[#6B8A7A] {
        color: #6B8A7A;
    }

    .bg-[#F8F4E1] {
        background-color: #F8F4E1;
    }

    .icon-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 8px;
        border-radius: 50%;
        background-color: #F8F4E1;
        color: #254336;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .icon-button:hover {
        background-color: #254336;
        color: white;
    }

    /* Grid layout for content and TOC */
    .content-wrapper {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
    }

    /* TOC Styles */
    .toc {
        display: none; /* Hide TOC by default on larger screens */
        background-color: #F8F4E1;
        border-radius: 8px;
        padding: 1rem;
        margin-top: 2rem;
    }

    #toc-right {
        position: sticky;
        top: 5rem; /* Adjust this value to match the height of your navbar */
        min-height: 200px; /* Set a minimum height for the TOC */
        max-height: 40vh; /* Ensure TOC doesn't stretch too much */
        overflow-y: auto; /* Enable scrolling if content exceeds max height */
        background-color: #F8F4E1;
        border-radius: 8px;
    }

    /* TOC Link Styling */
    .toc ul {
        list-style-type: none;
        padding-left: 0;
    }

    .toc ul li a {
        display: block;
        padding: 0.5rem 0;
        color: #254336;
        text-decoration: none;
        font-size: 0.9rem;
        transition: color 0.3s;
    }

    .toc ul li a:hover,
    .toc ul li a.active {
        color: #6B8A7A;
        font-weight: bold;
    }

    /* Responsive Layout */
    @media (min-width: 1024px) {
        .toc-top {
            display: none; /* Hide TOC below title on larger screens */
        }
        
        .content-wrapper {
            grid-template-columns: 3fr 1fr; /* Show TOC on right side on larger screens */
        }

        #toc-right {
            display: block;
        }
    }

    @media (max-width: 1023px) {
        .toc-top {
            display: block; /* Show TOC below title on smaller screens */
        }
        
        #toc-right {
            display: none; /* Hide TOC on right side on smaller screens */
        }
    }
</style>
{% endblock %}

{% block content %}
<section class="bg-[#FFFBF5] py-16">
    <div class="container max-w-full lg:max-w-[1080px] mx-auto px-4">
        <div class="content-wrapper">
            <div>
                <!-- TOC Below Title -->
                <div class="toc toc-top">
                    <h2 class="text-2xl font-semibold text-[#254336] mb-4">Table of Contents</h2>
                    <ul>
                        {% for item in toc %}
                            <li style="margin-left: {{ item.level|add:'-1' }}em;">
                                <a href="#{{ item.id }}" class="toc-link">
                                    {{ item.text }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Main Post Content -->
                <h1 class="text-4xl md:text-5xl font-bold text-[#254336] mb-8 mt-8">{{ post.title }}</h1>

                <!-- Author Info and Read Time -->
                <div class="flex flex-col md:flex-row md:justify-between md:items-center text-gray-600 mb-8">
                    <div class="flex items-center space-x-3">
                        <img src="https://via.placeholder.com/50" alt="Author Image" class="w-12 h-12 rounded-full">
                        <div>
                            <p class="text-lg font-semibold text-[#254336]">{{ post.author.name }}</p>
                            <p class="text-sm">Published {{ post.published_date|date:"H:i D, F Y" }}</p>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 flex items-center space-x-2">
                        <i class="fas fa-clock"></i>
                        <span>{{ post.read_time }} min read</span>
                        <i class="fas fa-eye mr-2"></i>
                        <span>{{ post.views }} views</span>
                    </div>
                </div>

                <!-- Featured Image -->
                <div class="mb-8">
                    <img src="{{ post.featured_image.url }}" alt="Post Image" class="w-full h-auto rounded-lg shadow-md">
                </div>

                <!-- Post Content -->
                <div class="prose max-w-none text-lg text-gray-700 leading-relaxed text-justify" style="text-indent: 4em;">
                    {{ post.content | safe }}
                </div>

                <!-- Share Buttons -->
                <div class="mt-8 flex items-center gap-4">
                    <span class="text-[#6B8A7A] text-lg">Share:</span>
                    <a href="https://twitter.com/share?url={{ request.build_absolute_uri }}" target="_blank" class="icon-button">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank" class="icon-button">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri }}" target="_blank" class="icon-button">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <button onclick="navigator.clipboard.writeText('{{ request.build_absolute_uri }}')" class="icon-button">
                        <i class="fas fa-link"></i>
                    </button>
                </div>

                <!-- Tags -->
                <div class="mt-12 flex flex-wrap gap-3">
                    {% for tag in post.tags.all %}
                        <a href="#" class="bg-[#F8F4E1] text-[#254336] text-xs font-semibold px-3 py-1 rounded-full hover:bg-[#254336] hover:text-white">
                            {{ tag.name }}
                        </a>
                    {% endfor %}
                </div>

                <!-- More Like This Section -->
                <div class="mt-12">
                    <h3 class="text-2xl font-semibold text-[#254336] mb-4">More Like This</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {% for related_post in related_posts %}
                            <div class="bg-white p-4 rounded-lg shadow-md">
                                <a href="{% url 'details' slug=related_post.slug %}">
                                    <img src="{{ related_post.featured_image.url }}" alt="{{ related_post.title }}" class="w-full h-auto rounded-lg mb-4">
                                    <h4 class="text-lg font-semibold text-[#254336]">{{ related_post.title }}</h4>
                                    <p class="text-sm text-[#6B8A7A]">{{ related_post.excerpt }}</p>
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Comments Section -->
                <div class="mt-12">
                    <h3 class="text-2xl font-semibold text-[#254336] mb-4" id="comments">Comments</h3>
                    {% for comment in comments %}
                        <div class="bg-white p-4 rounded-lg shadow-md mb-4">
                            <p class="font-semibold text-[#254336]">
                                {% if comment.author %}
                                    {{ comment.author_name }}
                                {% else %}
                                    {{ comment.username }}
                                {% endif %}
                            </p>
                            <p class="text-sm text-gray-600">{{ comment.created|date:"F j, Y, g:i a" }}</p>
                            <p class="mt-2">{{ comment.body }}</p>
                        </div>
                    {% empty %}
                        <p>No comments yet.</p>
                    {% endfor %}
                </div>
            </div>

            <!-- TOC on Right Side -->
            <div id="toc-right" class="toc">
                <h2 class="text-2xl font-semibold text-[#254336] mb-4">Table of Contents</h2>
                <ul>
                    {% for item in toc %}
                        <li style="margin-left: {{ item.level|add:'-1' }}em;">
                            <a href="#{{ item.id }}" class="toc-link">
                                {{ item.text }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</section>
{% endblock %}
